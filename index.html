<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forderungsschreiben-Generator | Meta DSGVO Schadensersatz</title>
  <meta name="description" content="Kostenloser Generator für DSGVO-Forderungsschreiben gegen Meta. Erstellen Sie rechtssichere Schreiben für Instagram & Facebook - lokal, sicher, ohne Tracking.">
  <meta name="author" content="Meta Letter Generator">
  <link rel="canonical" href="https://lettergen-de.github.io/meta-letter-generator/">
  
  <meta property="og:title" content="Forderungsschreiben-Generator | Meta DSGVO">
  <meta property="og:description" content="Kostenloser Generator für DSGVO-Forderungsschreiben gegen Meta. Lokal, sicher, ohne Tracking.">
  <meta property="og:type" content="website">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Forderungsschreiben-Generator | Meta DSGVO">
  <meta name="twitter:description" content="Kostenloser Generator für DSGVO-Forderungsschreiben gegen Meta.">
  
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ===== HERO SECTION ===== -->
  <header class="hero" id="top">
    <div class="container">
      <h1 class="hero-title">DSGVO-Forderungsschreiben<br>gegen Meta erstellen</h1>
      <p class="hero-subtitle">
        Erstellen Sie ein rechtlich fundiertes Schreiben zur Geltendmachung Ihres Schadensersatzanspruchs – lokal in Ihrem Browser, ohne Datenspeicherung.
      </p>
      <a href="#generator" class="hero-cta">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
        Zum Generator
      </a>
      
      <div class="trust-badges">
        <span class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
          Lokal im Browser
        </span>
        <span class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
          Keine Speicherung
        </span>
        <span class="trust-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle><line x1="1" y1="1" x2="23" y2="23"></line></svg>
          Kein Tracking
        </span>
      </div>
    </div>
  </header>

  <!-- ===== HOW IT WORKS ===== -->
  <section class="how-it-works" id="ablauf">
    <div class="container">
      <h2 class="section-title">So funktioniert's</h2>
      <div class="steps-grid">
        <div class="step-card">
          <span class="step-number">1</span>
          <h3 class="step-title">Schreiben erstellen</h3>
          <p class="step-desc">Formular ausfüllen, Text prüfen, Frist setzen</p>
        </div>
        <div class="step-card">
          <span class="step-number">2</span>
          <h3 class="step-title">Vorab versenden</h3>
          <p class="step-desc">Kann für Verzugszinsen relevant sein</p>
        </div>
        <div class="step-card">
          <span class="step-number">3</span>
          <h3 class="step-title">Nachweise sichern</h3>
          <p class="step-desc">PDF speichern, Versandnachweis aufbewahren, Reminder für Tag <span data-days>21</span> setzen</p>
        </div>
        <div class="step-card">
          <span class="step-number">4</span>
          <h3 class="step-title">Sammelklage anmelden</h3>
          <p class="step-desc">Danach oder parallel beim BfJ oder Drittanbieter</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== GENERATOR SECTION ===== -->
  <section class="generator-section" id="generator">
  <div class="container">
    <div class="gen-wrap">

  <!-- LEFT -->
  <div class="gen-card no-print">
    <h1>Forderungsschreiben-Generator (Meta)</h1>

    <div class="gen-muted">
      <span class="gen-pill">Lokal im Browser</span>
      <span class="gen-pill">Keine Server-Speicherung</span>
      <span class="gen-pill">Kein Tracking</span>
    </div>

    <p class="gen-muted">
      Erstellt eine eigenständig formulierte Textvorlage für ein Forderungsschreiben.
      „E-Mail vorbefüllen“ öffnet nur dein Mailprogramm – du kannst alles vor dem Absenden ändern.
    </p>

    <div class="gen-warn">
      <b>Rechtlicher Hinweis:</b> Dieses Tool stellt eine automatisierte Textvorlage zur individuellen Verwendung bereit und ersetzt keine Rechtsberatung.
      Es erfolgt keine Prüfung des Einzelfalls und keine Gewähr für Vollständigkeit, Aktualität oder rechtlichen Erfolg. Die Nutzung erfolgt auf eigene Verantwortung.
      <br><br>
      <b>Datenschutz:</b> Die eingegebenen Daten werden nach aktuellem Stand ausschließlich lokal im Browser verarbeitet und nicht an den Betreiber dieses Tools übermittelt.
      Beim Aufruf der Seite werden technisch notwendige Verbindungen zum Hosting-Anbieter (GitHub Pages) hergestellt.
    </div>

    <h2>1) Auswahl</h2>

    <label>Dienste</label>
    <div class="gen-inline">
      <label><input type="checkbox" id="useInsta" checked> Instagram</label>
      <label><input type="checkbox" id="useFb"> Facebook</label>
    </div>
    <p class="gen-muted">Empfänger-E-Mails werden automatisch gesetzt.</p>

    <label>Wie alt bist du aktuell?</label>
    <select id="ageStatus">
      <option value="adult">18 oder älter</option>
      <option value="minor">Unter 18</option>
    </select>

    <div id="minorAtSignupBlock" class="gen-inline">
      <label><input type="checkbox" id="wasMinorAtSignup"> Bei Anmeldung minderjährig</label>
    </div>
    <p class="gen-muted" id="minorAtSignupHint">Nur relevant, wenn du aktuell 18+ bist.</p>

    <div class="gen-hr"></div>

    <h2>2) Deine Daten</h2>

    <label>Name</label>
    <input id="name" placeholder="Max Mustermann" />

    <label>Straße & Hausnummer</label>
    <input id="street" placeholder="Musterstraße 1" />

    <label>PLZ & Ort</label>
    <input id="city" placeholder="12345 Musterstadt" />

    <label>E-Mail</label>
    <input id="email" placeholder="max@example.com" />

    <div id="instaBlock">
      <label>Instagram-Username</label>
      <input id="instaUser" placeholder="deinusername" />
      <label>Instagram genutzt seit</label>
      <input id="sinceInsta" value="April 2019" placeholder="Monat/Jahr" />
    </div>

    <div id="fbBlock" class="hidden">
      <label>Facebook-Profil-URL</label>
      <input id="fbUrl" placeholder="https://www.facebook.com/vorname.nachname..." />
      <label>Facebook genutzt seit</label>
      <input id="sinceFb" placeholder="z. B. 2020 oder ungefähr 3 Jahre" />
    </div>

    <div class="gen-row">
      <div>
        <label>Versanddatum</label>
        <input id="sendDate" type="date" />
        <div class="gen-muted">Wenn leer: heute</div>
      </div>
      <div>
        <label>Frist (Tage)</label>
        <input id="days" type="number" value="21" min="21" />
        <div class="gen-muted">Empfehlung: mindestens 21 Tage</div>
      </div>
    </div>

    <div class="gen-hr"></div>

    <h2>3) Zahlung (optional)</h2>

    <label>IBAN (optional)</label>
    <input id="iban" placeholder="DE… (kann auch leer bleiben)" />
    <p class="gen-muted">Wenn leer: im Brief bleibt „IBAN: [bitte angeben]“ stehen, du kannst es später selbst ergänzen.</p>

    <label>BIC (optional)</label>
    <input id="bic" placeholder="z. B. GENODEF1XXX (kann auch leer bleiben)" />

    <div class="gen-warn">
      Tipp: Wenn du IBAN/BIC nicht hier eingeben willst, lass es leer und trage es später direkt im Mailprogramm oder PDF ein.
    </div>

    <!-- MINOR SIGNATURE BLOCK -->
    <div id="minorSignBlock" class="hidden">
      <div class="gen-hr"></div>
      <h2>4) Unterschriften (nur unter 18)</h2>

      <label>Ort (Unterschrift)</label>
      <input id="placeSign" placeholder="z. B. Berlin" />

      <label>Datum (Unterschrift)</label>
      <input id="signDate" type="date" />

      <div class="gen-row">
        <div>
          <label>Name Erziehungsberechtigte/r 1</label>
          <input id="parent1" placeholder="Name" />
        </div>
        <div>
          <label>Name Erziehungsberechtigte/r 2 (optional)</label>
          <input id="parent2" placeholder="Name" />
        </div>
      </div>

      <p class="gen-muted">Im PDF können die Unterschriften handschriftlich erfolgen.</p>
    </div>

    <div class="gen-btns">
      <button id="copyBtn">Text kopieren</button>
      <button class="secondary" id="pdfBtn">PDF</button>
      <a class="btn secondary" id="mailtoBtn" href="#">E-Mail vorbefüllen</a>
    </div>

    <!-- ✅ unten: kurz + Details toggle -->

    <p class="gen-muted" style="margin-top:12px"><b>PDF:</b> Erzeugt ein sauberes PDF direkt aus dem Text.</p>
</div>

  <!-- RIGHT -->
  <div class="gen-card">
    <h2>Vorschau</h2>
    <pre id="out">Lade Vorlagen…</pre>
  </div>

</div>
  </div>
</section>

  <!-- ===== TIMING SECTION ===== -->
  <section class="timing-section" id="timing">
    <div class="container">
      <div class="timing-box">
        <h3 class="timing-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          Hinweis zum Timing (Zinsen)
        </h3>
        <p class="timing-text">
          In manchen Fällen kann ein möglicher Anspruch auf Verzugszinsen davon abhängen, dass ein Anspruch vorab geltend gemacht und eine Frist gesetzt wurde. Viele Betroffene versenden das Schreiben daher vor oder parallel zur Sammelklage.
        </p>
        <p class="timing-disclaimer">(Keine Rechtsberatung.)</p>
      </div>
    </div>
  </section>

  <!-- ===== SAMMELKLAGE SECTION ===== -->
  <section class="sammelklage-section" id="sammelklage">
    <div class="container">
      <h2 class="sammelklage-title">Danach oder parallel: Sammelklage anmelden</h2>
      
      <div class="sammelklage-grid">
        <!-- Card A: BfJ -->
        <div class="sammelklage-card">
          <h3 class="sammelklage-card-title">Verbandsklageregister (Bundesamt für Justiz)</h3>
          <p class="sammelklage-card-subtitle">Anmeldung im Verbandsklageregister</p>
          <p class="sammelklage-card-body">
            Anmeldung im Verbandsklageregister beim Bundesamt für Justiz.
          </p>
          <a href="https://www.bundesjustizamt.de/DE/Themen/Verbraucherrechte/VerbandsklageregisterMusterfeststellungsklagenregister/Verbandsklagenregister/Verbandsklagen/Klagen/202505/Anmeldung/Formular_node.html" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="width:100%;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            Zum Anmeldeformular
          </a>
          <p class="sammelklage-note">Die Anmeldung ist unabhängig von einem eigenen Schreiben möglich.</p>
        </div>
        
        <!-- Card B: Third Party -->
        <div class="sammelklage-card">
          <h3 class="sammelklage-card-title">Externe Anbieter (Drittanbieter)</h3>
          <p class="sammelklage-card-subtitle">Sammelklage-Anmeldung über private Anbieter</p>
          <p class="sammelklage-card-body">
            Externe Anbieter bündeln teils Anmeldungen.<br>
            Je nach Modell können im Erfolgsfall Kosten entstehen<br>
            (z.&nbsp;B. 9,5&nbsp;% Beteiligung).
          </p>
          <a href="https://www.meta-klage.de/" target="_blank" rel="noopener noreferrer" class="btn-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            Zur Anbieter-Website
          </a>
          <p class="sammelklage-disclaimer">Diese Seite steht in keiner Verbindung zu Drittanbietern.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="footer">
    <div class="container">
      <div class="footer-badges">
        <span class="footer-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
          Keine Datenspeicherung
        </span>
        <span class="footer-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
          Lokale Verarbeitung
        </span>
        <span class="footer-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle><line x1="1" y1="1" x2="23" y2="23"></line></svg>
          Kein Tracking
        </span>
      </div>
      <p class="footer-disclaimer">
        Dieses Tool stellt keine Rechtsberatung dar und ersetzt keinen Anwalt. Die Nutzung erfolgt auf eigene Verantwortung. Für Richtigkeit und Vollständigkeit wird keine Haftung übernommen.
      </p>
      <p class="footer-privacy">
        Alle Eingaben werden ausschließlich lokal in Ihrem Browser verarbeitet. Es erfolgt keine Übertragung an Server. Diese Seite wird über GitHub Pages gehostet (Standard-Verbindungsdaten).
      </p>
    </div>
  </footer>

  <!-- Accordion Toggle Script (minimal, no external deps) -->
  <script>
    function toggleAccordion(id) {
      var el = document.getElementById(id);
      if (el) {
        el.classList.toggle('open');
      }
    }
  </script>

  <!-- 
    YOUR EXISTING GENERATOR JS GOES HERE
    Include your existing scripts that handle:
    - Template loading from /templates/*.txt
    - Preview updates
    - PDF generation via /libs/jspdf.umd.min.js
    - Copy to clipboard
    - Mailto link generation
    - Age group toggle for #minorSignBlock
  -->

<!-- IMPORTANT: Put jsPDF file into your repo: /libs/jspdf.umd.min.js -->
<script src="libs/jspdf.umd.min.js"></script>

<script>
  const $ = (id) => document.getElementById(id);

  let TEMPLATE_ADULT = '';
  let TEMPLATE_MINOR = '';

  function fmtDateDE(d) {
    const dd = String(d.getDate()).padStart(2,'0');
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const yy = d.getFullYear();
    return `${dd}.${mm}.${yy}`;
  }

  function getSendDate() {
    const v = $('sendDate').value;
    if (!v) return new Date();
    const [y,m,d] = v.split('-').map(Number);
    return new Date(y, m-1, d);
  }

  function addDays(date, days) {
    const d = new Date(date);
    d.setDate(d.getDate() + Number(days));
    return d;
  }

  function replaceAll(template, map) {
    let out = template;
    for (const [k,v] of Object.entries(map)) out = out.split(k).join(v);
    return out;
  }

  // formats "max moritz mustermann" -> "Max Moritz Mustermann", supports "Jean-Paul", "O'Neill"
  function formatPersonName(raw) {
    const s = (raw || '').trim();
    if (!s) return '';

    const words = s.split(/\s+/);
    const capToken = (token) => {
      return token.split('-').map(part =>
        part.split("'").map(p =>
          p ? (p[0].toUpperCase() + p.slice(1).toLowerCase()) : ''
        ).join("'")
      ).join('-');
    };
    return words.map(capToken).join(' ');
  }

  function updateVisibility() {
    $('instaBlock').classList.toggle('hidden', !$('useInsta').checked);
    $('fbBlock').classList.toggle('hidden', !$('useFb').checked);

    const adult = $('ageStatus').value === 'adult';
    $('minorAtSignupBlock').classList.toggle('hidden', !adult);
    $('minorAtSignupHint').classList.toggle('hidden', !adult);
    if (!adult) $('wasMinorAtSignup').checked = false;

    const isMinor = $('ageStatus').value === 'minor';
    $('minorSignBlock').classList.toggle('hidden', !isMinor);
  }

  function buildRecipientEmails() {
    const emails = [];
    if ($('useFb').checked) emails.push('impressum-support@support.facebook.com');
    if ($('useInsta').checked) emails.push('impressum@support.instagram.com');
    if (emails.length === 0) emails.push('impressum@support.instagram.com');
    return emails.join(', ');
  }

  function buildSenderBlock() {
    const lines = [];
    lines.push(formatPersonName($('name').value) || '[Name]');
    lines.push($('street').value.trim() || '[Straße Hausnr]');
    lines.push($('city').value.trim() || '[PLZ Ort]');
    lines.push($('email').value.trim() || '[E-Mail]');

    const profiles = [];
    if ($('useFb').checked) {
      const fb = $('fbUrl').value.trim() || 'https://www.facebook.com/[dein.profil]';
      profiles.push(`Facebook-Profil: ${fb}`);
    }
    if ($('useInsta').checked) {
      const iu = $('instaUser').value.trim() || '[Benutzername]';
      profiles.push(`Instagram-Profil: https://www.instagram.com/${iu}/`);
    }
    if (profiles.length) lines.push(profiles.join('\n'));

    return lines.join('\n');
  }

  function buildServicesSentence() {
    const useFb = $('useFb').checked;
    const useInsta = $('useInsta').checked;

    const sinceFb = ($('sinceFb').value || '').trim() || '[Monat/Jahr oder ungefähr NN Jahren]';
    const sinceInsta = ($('sinceInsta').value || '').trim() || '[Monat/Jahr oder ungefähr NN Jahren]';

    if (useFb && useInsta) return `Ich nutze Ihre Dienste Facebook seit ${sinceFb} und Instagram seit ${sinceInsta}.`;
    if (useInsta) return `Ich nutze Ihren Dienst Instagram seit ${sinceInsta}.`;
    if (useFb) return `Ich nutze Ihren Dienst Facebook seit ${sinceFb}.`;
    return `Ich nutze Ihre Dienste Facebook und/oder Instagram.`;
  }

  function buildPaymentLine() {
    const iban = $('iban').value.trim();
    const bic = $('bic').value.trim();

    if (!iban) {
      return `durch Überweisung auf mein Konto, IBAN: [bitte angeben]${bic ? `, BIC: ${bic}` : `, BIC: [bitte angeben]`}`;
    }

    const bicPart = bic ? `, BIC: ${bic}` : '';
    return `durch Überweisung auf mein Konto, IBAN: ${iban}${bicPart}`;
  }

  async function loadTemplates() {
    const [adult, minor] = await Promise.all([
      fetch('templates/adult.txt', { cache: 'no-store' }).then(r => r.text()),
      fetch('templates/minor.txt', { cache: 'no-store' }).then(r => r.text()),
    ]);
    TEMPLATE_ADULT = adult;
    TEMPLATE_MINOR = minor;
  }

  function buildLetter() {
    if (!TEMPLATE_ADULT || !TEMPLATE_MINOR) {
      return 'Vorlagen fehlen. Bitte templates/adult.txt und templates/minor.txt im Repo anlegen.';
    }

    const ageStatus = $('ageStatus').value;
    const isMinor = ageStatus === 'minor';

    const sendDate = getSendDate();
    const deadline = addDays(sendDate, $('days').value || 21);

    if (isMinor && $('signDate') && !$('signDate').value) {
      $('signDate').value = $('sendDate').value;
    }

    const place = ($('placeSign')?.value || '').trim();
    const p1 = ($('parent1')?.value || '').trim();
    const p2 = ($('parent2')?.value || '').trim();

    const signDateVal = $('signDate')?.value;
    const signDate = signDateVal ? new Date(signDateVal) : sendDate;
    const placeOut = place || '[Ort]';

    const sigLine = '____________________________________________';

    const map = {
      '{{SENDER_BLOCK}}': buildSenderBlock(),
      '{{SIGNATURE_NAME}}': formatPersonName($('name').value) || '[Name]',
      '{{EMAILS}}': buildRecipientEmails(),
      '{{DATE}}': fmtDateDE(sendDate),
      '{{SERVICES_SENTENCE}}': buildServicesSentence(),
      '{{PAYMENT_LINE}}': buildPaymentLine(),
      '{{DEADLINE}}': fmtDateDE(deadline),
      '{{COMPENSATION}}': isMinor ? '10.000' : '5.000',
      '{{MINOR_SENTENCE_OPTIONAL}}':
        (!isMinor && $('wasMinorAtSignup').checked)
          ? 'Ich war bei der Anmeldung noch nicht volljährig.'
          : '',

      '{{SIGNATURE_CHILD_LINE}}': isMinor
        ? `${placeOut}, ${fmtDateDE(signDate)}\nUnterschrift: ${sigLine}`
        : '',
      '{{PARENTS_CONSENT_LINE}}': isMinor
        ? (p1 || p2
            ? `Die Erziehungsberechtigten (${[p1,p2].filter(Boolean).join(' und ')}) sind mit dieser Forderung auf Unterlassung und Schadenersatz einverstanden.`
            : `Die Erziehungsberechtigten sind mit dieser Forderung auf Unterlassung und Schadenersatz einverstanden.`)
        : '',
      '{{PARENTS_SIGNATURE_BLOCK}}': isMinor
        ? `${p1 || '[Name Erziehungsberechtigte/r]'}: ____________________________   (${placeOut}, ${fmtDateDE(signDate)})` +
          (p2 ? `\n${p2}: ____________________________   (${placeOut}, ${fmtDateDE(signDate)})` : '')
        : ''
    };

    const base = isMinor ? TEMPLATE_MINOR : TEMPLATE_ADULT;
    return replaceAll(base, map);
  }

  function refresh() {
    updateVisibility();

    const text = buildLetter();
    $('out').textContent = text;

    const to = buildRecipientEmails();
    const subject = encodeURIComponent('Aufforderung zur Unterlassung und Geltendmachung immateriellen Schadensersatzes (Art. 82 DSGVO)');
    const body = encodeURIComponent(text);
    $('mailtoBtn').href = `mailto:${encodeURIComponent(to)}?subject=${subject}&body=${body}`;

    // update "Tag X" dynamically for checklist + details
    document.querySelectorAll('[data-days]').forEach(el => {
      el.textContent = String($('days').value || 21);
    });
  }

  async function copyText() {
    try {
      await navigator.clipboard.writeText($('out').textContent);
      $('copyBtn').textContent = 'Kopiert';
      setTimeout(() => $('copyBtn').textContent = 'Text kopieren', 1200);
    } catch {
      alert('Kopieren nicht möglich. Bitte Text in der Vorschau markieren und manuell kopieren.');
    }
  }

  function downloadPdfWithoutUrl() {
    const text = $('out').textContent || '';
    if (!text.trim()) { alert('Kein Text vorhanden.'); return; }

    if (!window.jspdf || !window.jspdf.jsPDF) {
      alert('jsPDF wurde nicht geladen. Lege die Datei libs/jspdf.umd.min.js ins Repo und referenziere sie in index.html.');
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'mm', format: 'a4' });

    const margin = 15;
    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const maxWidth = pageWidth - margin * 2;

    doc.setFont('Times', 'Normal');
    doc.setFontSize(11);

    const lines = doc.splitTextToSize(text, maxWidth);
    const lineHeight = 5.2;

    let y = margin;
    for (let i = 0; i < lines.length; i++) {
      if (y + lineHeight > pageHeight - margin) {
        doc.addPage();
        y = margin;
        doc.setFont('Times', 'Normal');
        doc.setFontSize(11);
      }
      doc.text(lines[i], margin, y);
      y += lineHeight;
    }

    const stamp = new Date();
    const fname = `forderungsschreiben_${stamp.getFullYear()}-${String(stamp.getMonth()+1).padStart(2,'0')}-${String(stamp.getDate()).padStart(2,'0')}.pdf`;
    doc.save(fname);
  }

  document.addEventListener('input', refresh);
  $('copyBtn').addEventListener('click', copyText);
  $('pdfBtn').addEventListener('click', downloadPdfWithoutUrl);

  // ✅ Toggle „Details anzeigen/ausblenden“ (robust + simpel)
  $('toggleSteps')?.addEventListener('click', (e) => {
    e.preventDefault();
    const box = $('stepsDetails');
    if (!box) return;
    const isHidden = box.classList.contains('hidden');
    box.classList.toggle('hidden');
    $('toggleSteps').textContent = isHidden ? 'Details ausblenden' : 'Details anzeigen';
  });

  // Auto-format name on blur
  $('name').addEventListener('blur', () => {
    $('name').value = formatPersonName($('name').value);
    refresh();
  });

  const now = new Date();
  $('sendDate').value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;

  loadTemplates()
    .then(refresh)
    .catch(() => $('out').textContent = 'Fehler beim Laden der Vorlagen. Prüfe templates/adult.txt und templates/minor.txt.');
</script>
</body>
</html>

</body>
</html>
